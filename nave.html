<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1>Guerra navale</h1>


    <div id="marketDiv">
        <span id="mercatoSpan">
            <span style="display: flex;">
                <h2 style="padding-right: 20px;">Mercato</h2>
                <button id="endMarketBtn">Chiudi mercato</button>

            </span>
        </span>
        <section id="mercatoSect">

            <section class="marketSubSects">
                <h3>Navi</h3>
                <ul>
                    <li id="ship2Market">
                        <button class="minusBtn">-</button>
                        <span class="articleNameSpan">Nave da 2</span><img src="./assets/info.png" alt="info nave da 2"
                            class="infoIconMarket"> <span class="coinSpan">150 <img class="coin" alt="coin"
                                src="./assets/coin.png"></span>
                        <button class="plusBtn">+</button>
                    </li>
                    <li id="ship3Market">
                        <button class="minusBtn">-</button>
                        <span class="articleNameSpan">Nave da 3</span><img src="./assets/info.png" alt="info nave da 3"
                            class="infoIconMarket"> <span class="coinSpan">200 <img class="coin" alt="coin"
                                src="./assets/coin.png"></span>
                        <button class="plusBtn">+</button>
                    </li>
                    <li id="ship4Market">
                        <button class="minusBtn">-</button>
                        <span class="articleNameSpan">Nave da 4</span><img src="./assets/info.png" alt="info nave da 4"
                            class="infoIconMarket"> <span class="coinSpan">250 <img class="coin" alt="coin"
                                src="./assets/coin.png"></span>
                        <button class="plusBtn">+</button>
                    </li>

                </ul>
            </section>

            <section class="marketSubSects">
                <h3>Equipaggiamento di difesa</h3>
                <ul>
                    <li id="airDefenseMarket">
                        <button class="minusBtn">-</button>
                        <span class="articleNameSpan">Contraerea</span><img src="./assets/info.png"
                            alt="info contraerea" class="infoIconMarket"> <span class="coinSpan">200 <img class="coin"
                                alt="coin" src="./assets/coin.png"></span>
                        <button class="plusBtn">+</button>
                    </li>
                    <li id="jammerMarket">
                        <button class="minusBtn">-</button>
                        <span class=" articleNameSpan">Jammer</span><img src="./assets/info.png" alt="info jammer"
                            class="infoIconMarket"> <span class="coinSpan">150 <img class="coin" alt="coin"
                                src="./assets/coin.png"></span>
                        <button class="plusBtn">+</button>
                    </li>
                </ul>
            </section>

            <section class="marketSubSects">
                <h3>Equipaggiamento d'attacco</h3>
                <ul>

                    <li id="atomicMissileMarket">
                        <button class="minusBtn">-</button>
                        <span class=" articleNameSpan">Missile nucleare</span><img src="./assets/info.png"
                            alt="info missile nucleare" class="infoIconMarket"> <span class="coinSpan">200
                            <img class="coin" alt="coin" src="./assets/coin.png"></span>
                        <button class="plusBtn">+</button>
                    </li>
                    <li id="advancedMissileMarket">
                        <button class="minusBtn">-</button>
                        <span class=" articleNameSpan">Missile avanzato</span> <img src="./assets/info.png"
                            alt="info missile avanzato" class="infoIconMarket"> <span class="coinSpan">150
                            <img class="coin" alt="coin" src="./assets/coin.png"></span>
                        <button class="plusBtn">+</button>
                    </li>
                    <li id="alliedMissileMarket">
                        <button class="minusBtn">-</button>
                        <span class=" articleNameSpan">Missile alleato</span> <img src="./assets/info.png"
                            alt="info missile alleato" class="infoIconMarket"> <span class="coinSpan">100
                            <img class="coin" alt="coin" src="./assets/coin.png"></span>
                        <button class="plusBtn">+</button>
                    </li>
                </ul>
            </section>
            <section class="marketSubSects" id="goldSect">
                <img src="./assets/info.png" alt="info forziere" class="infoIconMarket">
                <img style="height:80px;" src="./assets/money.png" alt="tesoro">
                <h3 id="myMoney">600</h3>
            </section>
        </section>
    </div>

    </div>

    <div id="matchDiv">
        <section id="magazzinoSect">
            <span
                style="display: flex;     align-items: flex-start;    justify-content: flex-start; margin-bottom: 2vh;">
                <h2 style="padding:0 10px;">Magazzino</h2>
            </span>

            <ul id="myArmyList">
                <li>
                    <img src="./assets/turnObj.png" class="turnObjImg" alt="turnObj">
                    <img class="myArmyImg draggableElement not_visible vertical2Ship" src="./assets/ship2vert.png"
                        alt="ship2vert">
                    <img class="myArmyImg draggableElement horizontal2Ship" src="./assets/ship2.png" alt="ship2a">
                </li>
                <li>
                    <img src="./assets/turnObj.png" class="turnObjImg" alt="turnObj">
                    <img class="myArmyImg draggableElement not_visible vertical2Ship" src="./assets/ship2vert.png"
                        alt="ship2vert">
                    <img class="myArmyImg draggableElement horizontal2Ship" src="./assets/ship2.png" alt="ship2b">
                </li>
                <li>
                    <img src="./assets/turnObj.png" class="turnObjImg" alt="turnObj">
                    <img class="myArmyImg draggableElement not_visible  vertical3Ship" src="./assets/ship3vert.png"
                        alt="ship3vert">
                    <img class="myArmyImg draggableElement horizontal3Ship" src="./assets/ship3.png" alt="ship3">
                </li>
                <li>
                    <img src="./assets/turnObj.png" class="turnObjImg" alt="turnObj">
                    <img class="myArmyImg draggableElement not_visible vertical4Ship" src="./assets/ship4vert.png"
                        alt="ship4vert">
                    <img class="myArmyImg draggableElement horizontal4Ship" src="./assets/ship4.png" alt="ship4">
                </li>
                <li>
                    <img src="./assets/turnObj.png" class="turnObjImg" alt="turnObj">
                    <img class="myArmyImg draggableElement not_visible vertical5Ship" src="./assets/ship5vert.png"
                        alt="ship5vert">
                    <img class="myArmyImg draggableElement horizontal5Ship" src="./assets/ship5.png" alt="ship5">
                </li>

            </ul>

        </section>
        <section id="gridsSect">
            <span class="gridSpan">
                <span class="activeTurn" id="myGridSpan">
                    <h2 class="gridTitle">Le tue posizioni</h2>
                    <button style="display:none" id="readyBtn">Pronto!</button>
                </span>
                <img class="positionsImg" id="myPositionsImg" src="./assets/grid.png" alt="grid">
                <span id="myXAxisSpan">
                    <span class="spanLetterAxis">A</span>
                    <span class="spanLetterAxis">B</span>
                    <span class="spanLetterAxis">C</span>
                    <span class="spanLetterAxis">D</span>
                    <span class="spanLetterAxis">E</span>
                    <span class="spanLetterAxis">F</span>
                    <span class="spanLetterAxis">G</span>
                    <span class="spanLetterAxis">H</span>
                    <span class="spanLetterAxis">I</span>
                    <span class="spanLetterAxis">J</span>
                </span>
                <span id="myYAxisSpan">
                    <span class="spanLetterAxis">1</span>
                    <span class="spanLetterAxis">2</span>
                    <span class="spanLetterAxis">3</span>
                    <span class="spanLetterAxis">4</span>
                    <span class="spanLetterAxis">5</span>
                    <span class="spanLetterAxis">6</span>
                    <span class="spanLetterAxis">7</span>
                    <span class="spanLetterAxis">8</span>
                    <span class="spanLetterAxis">9</span>
                    <span class="spanLetterAxis">10</span>
                </span>
            </span>
            <span class="gridSpan">
                <span id="opponentGridSpan">
                    <h2 id="opponentPositionsH2" class="gridTitle">Le posizioni nemiche</h2>
                </span>
                <img class="positionsImg" id="opponentPositionsImg" src="./assets/grid.png" alt="grid">
                <span id="XAxisSpanAdv">
                    <span class="spanLetterAxis">A</span>
                    <span class="spanLetterAxis">B</span>
                    <span class="spanLetterAxis">C</span>
                    <span class="spanLetterAxis">D</span>
                    <span class="spanLetterAxis">E</span>
                    <span class="spanLetterAxis">F</span>
                    <span class="spanLetterAxis">G</span>
                    <span class="spanLetterAxis">H</span>
                    <span class="spanLetterAxis">I</span>
                    <span class="spanLetterAxis">J</span>
                </span>
                <span id="YAxisSpanAdv">
                    <span class="spanLetterAxis">1</span>
                    <span class="spanLetterAxis">2</span>
                    <span class="spanLetterAxis">3</span>
                    <span class="spanLetterAxis">4</span>
                    <span class="spanLetterAxis">5</span>
                    <span class="spanLetterAxis">6</span>
                    <span class="spanLetterAxis">7</span>
                    <span class="spanLetterAxis">8</span>
                    <span class="spanLetterAxis">9</span>
                    <span class="spanLetterAxis">10</span>
                </span>
            </span>
        </section>
        <section style="display: flex">
            <p id="myScreenAssistant"></p>
            <form id="newMatchConsole">
                <label for="myName">Scegli un nome:</label>
                <input type="text" id="myName" name="myName" placeholder="Nome (massimo 15 caratteri)" required>
                <label for="IDMatch">ID partita (se partecipi):</label>
                <input type="number" id="IDMatch" name="IDMatch" placeholder="ID partita - opzionale" required>
                <button type="submit">Partecipa</button>
                <button type="button" id="hostButton">Ospita</button>
            </form>

        </section>

    </div>
</body>

</html>

<script>
    let myPositionsImgLeft
    let myPositionsImgTop
    let opponentPositionsImgLeft
    let opponentPositionsImgTop
    let gridStep
    let calculateClickedCell
    let shipsPositionsCells = []
    let takenCellArray = []
    let freeCell = true
    let effectiveIDMatch
    isMyTurn = false
    let myOpponentName

    let plusBtnArray = document.getElementsByClassName("plusBtn")
    let minusBtnArray = document.getElementsByClassName("minusBtn")
    let interval



    let infoIconsArray = document.getElementsByClassName("infoIconMarket")

    function joinedAMatch(IDMatch, myName) {
        console.log("a")
        marketDiv.style.opacity = "1"
        readyBtn.style.display = "block"
        document.getElementById("IDMatch").value = IDMatch
        document.getElementById("IDMatch").style.backgroundColor = "green"
        document.getElementById("IDMatch").style.color = "#ffe4bb"
        document.getElementById("IDMatch").style.fontWeight = "700"
        document.getElementById("IDMatch").style.letterSpacing = "2px"
        document.getElementById("IDMatch").addEventListener("click", () => { printScreenAssistantMessage("Ora non puoi modificare l'id perché sei in una partita.") })
        document.getElementById("myName").value = myName
        document.getElementById("myName").style.backgroundColor = "green"
        document.getElementById("myName").style.letterSpacing = "2px"
        document.getElementById("myName").addEventListener("click", () => { printScreenAssistantMessage("Ora non puoi modificare il nome perché sei in una partita.") })
        document.getElementById("myName").style.color = "#ffe4bb"
        document.getElementById("myName").style.fontWeight = "700"
        document.getElementById("myName").setAttribute('readonly', true)
        document.getElementById("IDMatch").setAttribute('readonly', true)


    }

    hostButton.addEventListener('click', function (event) {
        console.log("sa")
        const myName = document.getElementById('myName').value;
        const IDMatch = document.getElementById('IDMatch').value;
        document.getElementById('IDMatch').value = "";

        if (myName != "" && myName.length < 16) {
            const data = {
                myName: myName,
            };
            fetch('http://localhost:3001/api/connect', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then(response => {
                    return response.json().then(responseBody => {
                        if (response.ok) {
                            localStorage.setItem('tokenGND', responseBody.token)
                            printScreenAssistantMessage(responseBody.message);
                            effectiveIDMatch = responseBody.message.split("The id is ")[1].replace(".", "")
                            joinedAMatch(effectiveIDMatch, myName)

                        } else {
                            printScreenAssistantMessage(responseBody.error);
                            throw new Error('Network response was not ok: ' + responseBody.error);
                        }
                    });
                });
        } else {
            alert("Errore nel formulario")
            printScreenAssistantMessage("Il formulario non è completato correttamente. Ricorda che il nome non può superare 15 caratteri");
        }
    });

    newMatchConsole.addEventListener('submit', function (event) { //if click to join a match
        event.preventDefault();
        const IDMatch = document.getElementById('IDMatch').value;
        const myName = document.getElementById('myName').value;
        effectiveIDMatch = IDMatch
        console.log("saa")
        if (myName != "" && myName.length < 16 && IDMatch != "" && !isNaN(IDMatch)) {
            const data = {
                IDMatch: IDMatch,
                myName: myName,
            };


            fetch('http://localhost:3001/api/connect', {
                method: 'POST',
                headers: {

                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then(response => {
                    return response.json().then(responseBody => {
                        if (response.ok) {
                            localStorage.setItem('tokenGND', responseBody.token)
                            printScreenAssistantMessage(responseBody.message);
                            joinedAMatch(IDMatch, myName)

                        } else {
                            printScreenAssistantMessage(responseBody.error);
                            throw new Error('Network response was not ok: ' + responseBody.error);
                        }
                    });
                });
        } else {
            alert("Errore nel formulario")
            printScreenAssistantMessage("Il formulario non è completato correttamente. Ricorda che il nome non può superare 15 caratteri");
        }
    });

    function infoMarketMsg() {
        console.log("asaaa")
        for (let i = 0; i < infoIconsArray.length; i++) {
            let infoVal = infoIconsArray[i].alt.split("info ")[1]
            switch (infoVal) {
                case "nave da 2":

                    infoIconsArray[i].addEventListener("click", (e) => {
                        printScreenAssistantMessage("Questa è una semplice nave da 2 celle.")
                        e.stopPropagation()
                    }
                    )
                    break;
                case "nave da 3":
                    infoIconsArray[i].addEventListener("click", (e) => {

                        printScreenAssistantMessage("Questa è una semplice nave da 3 celle.")
                        e.stopPropagation()

                    })
                    break;
                case "nave da 4":
                    infoIconsArray[i].addEventListener("click", (e) => {
                        printScreenAssistantMessage("Questa è una semplice nave da 4 celle.")
                        e.stopPropagation()

                    })
                    break;

                case "contraerea":
                    infoIconsArray[i].addEventListener("click", (e) => {
                        printScreenAssistantMessage("Questa difesa aerea userà i suoi due colpi per neutralizzare i missili convenzionali diretti verso le tue navi vicine (5x5 celle)")
                        e.stopPropagation()

                    })
                    break;
                case "jammer":
                    infoIconsArray[i].addEventListener("click", (e) => {
                        printScreenAssistantMessage("Questa è un jammer può deviare i missili nemici che vengono lanciati nelle sue vicinanze (3x3 celle).")
                        e.stopPropagation()

                    })
                    break;
                case "missile nucleare":
                    infoIconsArray[i].addEventListener("click", (e) => {
                        printScreenAssistantMessage("Questo missile renderà inutilizzabile una porzione della mappa dell'avversario (2x2 celle) per tutta la guerra. Non va posizionato.")
                        e.stopPropagation()

                    })
                    break;
                case "missile avanzato":
                    infoIconsArray[i].addEventListener("click", (e) => {
                        printScreenAssistantMessage("Questa è un missile avanzato che non può essere deviato o neutralizzato. Non va posizionato.")
                        e.stopPropagation()

                    })
                    break;
                case "missile alleato":
                    infoIconsArray[i].addEventListener("click", (e) => {
                        printScreenAssistantMessage("Questa è un missile alleato che verrà lanciato autonomamente sulla mappa nemica. Non inciderà sul tuo turno. Non va posizionato.")
                        e.stopPropagation()

                    })
                    break;
                case "forziere":
                    infoIconsArray[i].addEventListener("click", (e) => {
                        printScreenAssistantMessage("Questa è il tuo forziere. Qui puoi vedere le tue monete, spendibili nel mercato.")
                        e.stopPropagation()

                    })
                    break;

                default:
                    console.log("there is a problem?")
                    break;
            }

        }

    }





    function buyNewArticle(id) {
        console.log("aww")
        if (!stopMarket) {
            let newMyMoney = parseInt(myMoney.textContent) - articlesInventory[id].price
            if (newMyMoney < 0) {
                alert("Non hai abbastanza monete")
                printScreenAssistantMessage("Non hai abbastanza monete per finalizzare questo acquisto.")
            }
            else {
                myArmyList.innerHTML += articlesInventory[id].li
                makeShipsTurnable()
                openMarketScreenMsgs()
                // makeMagazzinoDraggable()
                myMoney.innerText = newMyMoney
            }
        }
        else {
            alert("Il mercato è ormai chiuso")
            printScreenAssistantMessage("Non è possibile riaprire il mercato ormai.")
        }
    }

    function sellArticle(id) {
        console.log("qqqa")
        if (!stopMarket) {
            let arrayThisArticle = document.getElementsByClassName(id)
            if (arrayThisArticle.length > 0) {
                arrayThisArticle[arrayThisArticle.length - 1].remove()
                myMoney.innerText = parseInt(myMoney.textContent) + articlesInventory[id].price
                for (let i = 0; i < document.getElementsByClassName("turnObjImg").length; i++) {
                    let thisShip = document.getElementsByClassName("turnObjImg")[i]
                    thisShip.addEventListener("click", () => { turnThisShip(thisShip) })
                }
                makeShipsTurnable()
                openMarketScreenMsgs()

                //makeMagazzinoDraggable()
            }
            else {
                alert("Puoi vendere solo gli oggetti che hai comprato")
                printScreenAssistantMessage("Non puoi vendere gli oggetti che costituiscono la squadra base.")
            }
        }
        else {
            alert("Il mercato è ormai chiuso")
            printScreenAssistantMessage("Non è possibile riaprire il mercato.")
        }
    }


    function activateMarket() {
        console.log("qqqqa")
        for (let i = 0; i < plusBtnArray.length; i++) {
            plusBtnArray[i].addEventListener("click", () => { buyNewArticle(plusBtnArray[i].parentNode.id.split("Market")[0]) })
            minusBtnArray[i].addEventListener("click", () => { sellArticle(minusBtnArray[i].parentNode.id.split("Market")[0]) })
        }
    }
    activateMarket()
    let allNotDraggableElements = []
    function amIReady() {
        console.log("abbb")
        let allMyArticles = document.getElementsByClassName("draggableElement");
        for (let i = 0; i < allMyArticles.length; i++) {
            if (allMyArticles[i].style.position !== "absolute" && !allMyArticles[i].classList.contains("not_visible")) {
                printScreenAssistantMessage("Qualcosa non è ancora stato posizionato. Forse si tratta di " + allMyArticles[i].src.split("assets/")[1].split(".png")[0]);
                return;
            }
        }
        let myNotDraggablesArtsArray = document.getElementsByClassName("not_draggable")

        for (let i = 0; i < myNotDraggablesArtsArray.length; i++) {
            let newNotDraggableElement = {
                type: myNotDraggablesArtsArray[i].src.split("assets/")[1].split(".png")[0],
                direction: "special",
                length: "special",
                height: "special",
                positions: ["special"]
            }
            allNotDraggableElements.push(newNotDraggableElement)
        }
        console.log(shipsPositionsCells)//array all  draggable elements positions
        console.log(allArticlesPositions) //array oggetti  draggable elements data
        console.log(allNotDraggableElements) //array oggetti not draggable elements data



        const data = {
            allDraggableElementsPositions: shipsPositionsCells,
            allDraggableElementsData: allArticlesPositions,
            allNotDraggableElementsData: allNotDraggableElements,
            IDMatch: effectiveIDMatch,
            myName: myName.value
        };
        if (!localStorage.getItem("tokenGND")) {
            alert("Problema di autentificazione: purtroppo la partita è da rifare");
            return
        }
        const token = localStorage.getItem('tokenGND')
        fetch('http://localhost:3001/api/startMatch', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
            .then(response => {
                return response.json().then(responseBody => {
                    if (response.ok) {
                        printScreenAssistantMessage(responseBody.message);
                        myOpponentName = responseBody.opponent
                        opponentPositionsH2.innerText = "Le posizioni di " + myOpponentName
                        readyBtn.style.display = "none"
                        if (document.getElementById("myScreenAssistant").textContent.includes("è il tuo turno")) {
                            isMyTurn = true
                            if (!myGridSpan.classList.contains("activeTurn")) {
                                myGridSpan.classList.add("activeTurn");
                                opponentGridSpan.classList.remove("activeTurn");
                            }
                        }
                        else {
                            isMyTurn = false
                            if (myGridSpan.classList.contains("activeTurn")) {
                                myGridSpan.classList.remove("activeTurn");
                                opponentGridSpan.classList.add("activeTurn");
                                interval = setInterval(turnStarts, 1500);
                            }
                        }

                    } else {
                        printScreenAssistantMessage(responseBody.error);
                        throw new Error('Network response was not ok: ' + responseBody.error);
                    }
                });
            });
    }

    readyBtn.addEventListener("click", amIReady)

    const articlesInventory = {
        ship2: {
            price: 150,
            li: `<li class="ship2">
                    <img src="./assets/turnObj.png" class="turnObjImg" alt="turnObj">
                    <img class="myArmyImg draggableElement not_visible vertical2Ship" src="./assets/ship2vert.png" alt="ship2vert">
                    <img class="myArmyImg draggableElement horizontal2Ship" src="./assets/ship2.png" alt="ship2a">
                </li>`
        },
        ship3: {
            price: 200,
            li: `<li class="ship3">
                    <img src="./assets/turnObj.png" class="turnObjImg" alt="turnObj">
                    <img class="myArmyImg draggableElement not_visible  vertical3Ship" src="./assets/ship3vert.png" alt="ship3vert">
                    <img class="myArmyImg draggableElement horizontal3Ship" src="./assets/ship3.png" alt="ship3">
                </li>`
        },
        ship4: {
            price: 250,
            li: `<li class="ship4">
                    <img src="./assets/turnObj.png" class="turnObjImg" alt="turnObj">
                    <img class="myArmyImg draggableElement not_visible vertical4Ship" src="./assets/ship4vert.png" alt="ship4vert">
                    <img class="myArmyImg draggableElement horizontal4Ship" src="./assets/ship4.png" alt="ship4">
                </li>`
        },
        airDefense: {
            price: 200,
            li: `<li class="airDefense">
                    <img class="myArmyImg draggableElement armyObj" src="./assets/airDefense2.png" alt="air defense">
                </li>`
        },
        jammer: {
            price: 150,
            li: `<li class="jammer">
                    <img class="myArmyImg draggableElement armyObj" src="./assets/jammer.png" alt="jammer">
                </li>`
        },
        atomicMissile: {
            price: 200,
            li: `<li class="atomicMissile">
                    <img class="myArmyImg not_draggable armyObj" src="./assets/atomicBomb.png" alt="atomic missile">
                </li>`
        },
        advancedMissile: {
            price: 150,
            li: `<li class="advancedMissile">
                    <img class="myArmyImg  not_draggable armyObj" src="./assets/advancedMissile.png" alt="advanced missile">
                </li>`
        },
        alliedMissile: {
            price: 100,
            li: `<li class="alliedMissile">
                    <img class="myArmyImg not_draggable  armyObj" src="./assets/alliedMissile.png" alt="allied missile">
                </li>`
        }
    };


    function calculateBombsPositions() {
        console.log("werwera")
        myPositionsImgLeft = myPositionsImg.getBoundingClientRect().left + window.scrollX
        myPositionsImgTop = myPositionsImg.getBoundingClientRect().top + window.scrollY
        opponentPositionsImgLeft = opponentPositionsImg.getBoundingClientRect().left + window.scrollX;
        opponentPositionsImgTop = opponentPositionsImg.getBoundingClientRect().top + window.scrollY
        gridStep = 300 / 10
    }

    function turnThisShip(ship) {
        console.log("zzza")
        let verticalShip = ship.parentNode.childNodes[3];
        let horizontalShip = ship.parentNode.childNodes[5];
        let wasVerticalShipNotVisible = verticalShip.classList.contains("not_visible");
        let wasHorizontalShipNotVisible = horizontalShip.classList.contains("not_visible");

        if (wasHorizontalShipNotVisible) {
            horizontalShip.classList.remove("not_visible")
        }
        if (wasVerticalShipNotVisible) {
            verticalShip.classList.remove("not_visible")
        }

        if (wasHorizontalShipNotVisible) {
            verticalShip.classList.add("not_visible")
        } else if (wasVerticalShipNotVisible) {
            horizontalShip.classList.add("not_visible")
        }
    }
    function makeShipsTurnable() {
        console.log("eeeeea")
        for (let i = 0; i < document.getElementsByClassName("turnObjImg").length; i++) {
            let thisShip = document.getElementsByClassName("turnObjImg")[i]
            thisShip.addEventListener("click", () => { turnThisShip(thisShip) })
        }
    }

    function calculateAxisPositions() {
        console.log("a222")
        myXAxisSpan.style.top = (myPositionsImgTop - 30) + "px"
        myXAxisSpan.style.left = (myPositionsImgLeft) + "px"
        XAxisSpanAdv.style.top = (opponentPositionsImgTop - 30) + "px"
        XAxisSpanAdv.style.left = (opponentPositionsImgLeft) + "px"

        myYAxisSpan.style.top = (myPositionsImgTop) + "px"
        myYAxisSpan.style.left = (myPositionsImgLeft - 30) + "px"
        YAxisSpanAdv.style.top = (opponentPositionsImgTop) + "px"
        YAxisSpanAdv.style.left = (opponentPositionsImgLeft - 30) + "px"
    }

    function printScreenAssistantMessage(message) {
        console.log("23a")
        if (myScreenAssistant.textContent != message) {
            myScreenAssistant.style.backgroundColor = "green"
            myScreenAssistant.innerHTML = message
            setTimeout(() => {
                myScreenAssistant.style.backgroundColor = "rgba(0, 0, 0, 0.521)"

            }, 200);
        }
    }

    function infoObj(obj) {
        console.log("a2322")
        let objName = (obj.src.split("assets/")[1].split(".png")[0])
        if (objName == "ship2" || objName == "ship2vert") {
            printScreenAssistantMessage("Questa è una nave da 2 celle. Puoi usare la freccia verde per girarla. Prima di posizionarla devi chiudere il mercato.")

        }
        if (objName == "ship3" || objName == "ship3vert") {
            printScreenAssistantMessage("Questa è una nave da 3 celle. Puoi usare la freccia verde per girarla. Prima di posizionarla devi chiudere il mercato.")
        }
        if (objName == "ship4" || objName == "ship4vert") {
            printScreenAssistantMessage("Questa è una nave da 4 celle. Puoi usare la freccia verde per girarla. Prima di posizionarla devi chiudere il mercato.")
        }
        if (objName == "ship5" || objName == "ship5vert") {
            printScreenAssistantMessage("Questa è una nave da 5 celle. Puoi usare la freccia verde per girarla. Prima di posizionarla devi chiudere il mercato.")
        }
        if (objName == "airDefense2") {
            printScreenAssistantMessage("Questa difesa aerea userà i suoi due colpi per neutralizzare i missili convenzionali diretti verso le tue navi vicine (5x5 celle).")
        }
        if (objName == "atomicBomb") {
            printScreenAssistantMessage("Questo missile renderà inutilizzabile una porzione della mappa dell'avversario (2x2 celle) per tutta la guerra. Non va posizionato.")
        }
        if (objName == "jammer") {
            printScreenAssistantMessage("Questa è un jammer può deviare i missili nemici che vengono lanciati nelle sue vicinanze (3x3 celle).")
        }
        if (objName == "alliedMissile") {
            printScreenAssistantMessage("Questa è un missile alleato che verrà lanciato autonomamente sulla mappa nemica. Non inciderà sul tuo turno. Non va posizionato.")
        }
        if (objName == "advancedMissile") {
            printScreenAssistantMessage("Questa è un missile avanzato che non può essere deviato o neutralizzato. Non va posizionato.")
        }


    }

    function infoObjHandler(event) {
        console.log("a222")
        infoObj(event.target);
    }

    function marketSubSectHandler() {
        console.log("affff")
        printScreenAssistantMessage("Questo è il mercato: <br> potrai comprare e vendere oggetti, se hai abbastanza monete.");
    }

    function opponentPositionHandler() {
        console.log("ccccccca")
        printScreenAssistantMessage("Questa è la griglia nemica che dovrai attaccare.");
    }

    function myPositionHandler() {
        console.log("zzazaa")
        printScreenAssistantMessage("Questa è la tua griglia. Quando vuoi, chiudi il mercato e inizia a posizionare gli elementi.");
    }

    function openMarketScreenMsgs() {
        console.log("klòa")
        if (!stopMarket) {
            let myArmyImgArray = document.getElementsByClassName("myArmyImg");
            let marketSubSectsArray = document.getElementsByClassName("marketSubSects");

            for (let i = 0; i < myArmyImgArray.length; i++) {
                myArmyImgArray[i].addEventListener("click", infoObjHandler);
            }
            for (let i = 0; i < marketSubSectsArray.length; i++) {
                marketSubSectsArray[i].addEventListener("click", marketSubSectHandler);
            }
            opponentPositionsImg.addEventListener("click", opponentPositionHandler);
            myPositionsImg.addEventListener("click", myPositionHandler);
        }
    }

    function removeListenerMsgOpenMarket() {
        console.log("kddddlòa")
        let myArmyImgArray = document.getElementsByClassName("myArmyImg");
        let marketSubSectsArray = document.getElementsByClassName("marketSubSects");

        for (let i = 0; i < myArmyImgArray.length; i++) {
            myArmyImgArray[i].removeEventListener("click", infoObjHandler);
        }
        for (let i = 0; i < marketSubSectsArray.length; i++) {
            marketSubSectsArray[i].removeEventListener("click", marketSubSectHandler);
        }

        opponentPositionsImg.removeEventListener("click", opponentPositionHandler);
        myPositionsImg.removeEventListener("click", myPositionHandler);
    }


    function setScreenAssistantPosition() {
        console.log("qklòa")
        myScreenAssistant.style.marginLeft = myPositionsImgLeft + "px"
        printScreenAssistantMessage("Benvenuto,<br> Qui potrai leggere messaggi importanti ed avere informazioni su oggetti.")
    }
    function setNewMatchConsolePosition() {
        console.log("k222lòa")
        newMatchConsole.style.marginLeft = opponentPositionsImgLeft - myPositionsImgLeft - 300 + "px"
    }

    window.addEventListener('load', () => { calculateBombsPositions(), calculateAxisPositions(), setScreenAssistantPosition(), setNewMatchConsolePosition(), infoMarketMsg(), openMarketScreenMsgs(), makeShipsTurnable() })
    // window.addEventListener('load', () => { calculateBombsPositions(), calculateAxisPositions() })
    // window.addEventListener("load", makeShipsTurnable)
    //window.addEventListener('load', () => { calculateBombsPositions(), calculateAxisPositions(), setScreenAssistantPosition(), openMarketScreenMsgs() })
    window.addEventListener('resize', () => { calculateBombsPositions(), calculateAxisPositions(), setScreenAssistantPosition(), setNewMatchConsolePosition(), infoMarketMsg(), openMarketScreenMsgs(), makeShipsTurnable() })



    function logCoordinates(event, grid) {
        console.log("kl213123123òa")
        if (!isMyTurn) {
            printScreenAssistantMessage("Non è ancora il tuo turno.")
            return
        }
        var xClick = event.clientX + window.scrollX;
        var yClick = event.clientY + window.scrollY;


        if (grid == "opponentGrid") { //to calculate x
            if (xClick < (gridStep + opponentPositionsImgLeft)) {
                calculateClickedCell = "A"
            }
            else if (xClick < (2 * gridStep + opponentPositionsImgLeft)) {
                calculateClickedCell = "B"
            }
            else if (xClick < (3 * gridStep + opponentPositionsImgLeft)) {
                calculateClickedCell = "C"
            }
            else if (xClick < (4 * gridStep + opponentPositionsImgLeft)) {
                calculateClickedCell = "D"
            }
            else if (xClick < (5 * gridStep + opponentPositionsImgLeft)) {
                calculateClickedCell = "E"
            }
            else if (xClick < (6 * gridStep + opponentPositionsImgLeft)) {
                calculateClickedCell = "F"
            }
            else if (xClick < (7 * gridStep + opponentPositionsImgLeft)) {
                calculateClickedCell += "G"
            }
            else if (xClick < (8 * gridStep + opponentPositionsImgLeft)) {
                calculateClickedCell = "H"
            }
            else if (xClick < (9 * gridStep + opponentPositionsImgLeft)) {
                calculateClickedCell = "I"
            }
            else if (xClick < (10 * gridStep + opponentPositionsImgLeft)) {
                calculateClickedCell = "J"
            }
            if (grid == "opponentGrid") { //to calculate y
                if (yClick < (gridStep + opponentPositionsImgTop)) {
                    calculateClickedCell += "1"
                    circleBombAnimation()

                }
                else if (yClick < (2 * gridStep + opponentPositionsImgTop)) {
                    calculateClickedCell += "2"
                    circleBombAnimation()

                }
                else if (yClick < (3 * gridStep + opponentPositionsImgTop)) {
                    calculateClickedCell += "3"
                    circleBombAnimation()

                }
                else if (yClick < (4 * gridStep + opponentPositionsImgTop)) {
                    calculateClickedCell += "4"
                    circleBombAnimation()

                }
                else if (yClick < (5 * gridStep + opponentPositionsImgTop)) {
                    calculateClickedCell += "5"
                    circleBombAnimation()

                }
                else if (yClick < (6 * gridStep + opponentPositionsImgTop)) {
                    calculateClickedCell += "6"
                    circleBombAnimation()

                }
                else if (yClick < (7 * gridStep + opponentPositionsImgTop)) {
                    calculateClickedCell += "7"
                    circleBombAnimation()

                }
                else if (yClick < (8 * gridStep + opponentPositionsImgTop)) {
                    calculateClickedCell += "8"
                    circleBombAnimation()

                }
                else if (yClick < (9 * gridStep + opponentPositionsImgTop)) {
                    calculateClickedCell += "9"
                    circleBombAnimation()

                }
                else if (yClick < (10 * gridStep + opponentPositionsImgTop)) {
                    calculateClickedCell += "10"
                    circleBombAnimation()

                }
            }
        }

        function circleBombAnimation() {
            console.log("klffffffòa")
            let xBombed = calculateClickedCell[0];
            let yBombed = calculateClickedCell.slice(1)
            let theoreticalXBombed //for bombing animation purpose
            let theoreticalYBombed //for bombing animation purpose
            let bombedCell
            console.log(xBombed, yBombed + " ECCOOOOOOOOOOOOO")
            switch (xBombed) {
                case "A":
                    theoreticalXBombed = gridStep / 2 + opponentPositionsImgLeft
                    bombedCell = "A"
                    break;
                case "B":
                    theoreticalXBombed = gridStep + gridStep / 2 + opponentPositionsImgLeft
                    bombedCell = "B"
                    break;
                case "C":
                    theoreticalXBombed = 2 * gridStep + gridStep / 2 + opponentPositionsImgLeft
                    bombedCell = "C"
                    break;
                case "D":
                    theoreticalXBombed = 3 * gridStep + gridStep / 2 + opponentPositionsImgLeft
                    bombedCell = "D"
                    break;
                case "E":
                    theoreticalXBombed = 4 * gridStep + gridStep / 2 + opponentPositionsImgLeft;
                    bombedCell = "E"
                    break;
                case "F":
                    theoreticalXBombed = 5 * gridStep + gridStep / 2 + opponentPositionsImgLeft
                    bombedCell = "F"
                    break;
                case "G":
                    theoreticalXBombed = 6 * gridStep + gridStep / 2 + opponentPositionsImgLeft
                    bombedCell = "G"
                    break;
                case "H":
                    theoreticalXBombed = 7 * gridStep + gridStep / 2 + opponentPositionsImgLeft
                    bombedCell = "H"
                    break;
                case "I":
                    theoreticalXBombed = 8 * gridStep + gridStep / 2 + opponentPositionsImgLeft
                    bombedCell = "I"
                    break;
                case "J":
                    theoreticalXBombed = 9 * gridStep + gridStep / 2 + opponentPositionsImgLeft
                    bombedCell = "J"
                    break;
                default:
                    alert("Valore di xBombed non valido: " + xBombed);
            }
            switch (yBombed) {
                case "1":
                    theoreticalYBombed = gridStep / 2 + opponentPositionsImgTop
                    bombedCell += "1"
                    turnEnds(bombedCell, theoreticalXBombed, theoreticalYBombed)
                    break;
                case "2":
                    theoreticalYBombed = gridStep + gridStep / 2 + opponentPositionsImgTop
                    bombedCell += "2"
                    turnEnds(bombedCell, theoreticalXBombed, theoreticalYBombed)
                    break;
                case "3":
                    theoreticalYBombed = 2 * gridStep + gridStep / 2 + opponentPositionsImgTop
                    bombedCell += "3"
                    turnEnds(bombedCell, theoreticalXBombed, theoreticalYBombed)
                    break;
                case "4":
                    theoreticalYBombed = 3 * gridStep + gridStep / 2 + opponentPositionsImgTop
                    bombedCell += "4"
                    turnEnds(bombedCell, theoreticalXBombed, theoreticalYBombed)
                    break;
                case "5":
                    theoreticalYBombed = 4 * gridStep + gridStep / 2 + opponentPositionsImgTop
                    bombedCell += "5"
                    turnEnds(bombedCell, theoreticalXBombed, theoreticalYBombed)
                    break;
                case "6":
                    theoreticalYBombed = 5 * gridStep + gridStep / 2 + opponentPositionsImgTop
                    bombedCell += "6"
                    turnEnds(bombedCell, theoreticalXBombed, theoreticalYBombed)
                    break;
                case "7":
                    theoreticalYBombed = 6 * gridStep + gridStep / 2 + opponentPositionsImgTop
                    bombedCell += "7"
                    turnEnds(bombedCell, theoreticalXBombed, theoreticalYBombed)
                    break;
                case "8":
                    theoreticalYBombed = 7 * gridStep + gridStep / 2 + opponentPositionsImgTop
                    bombedCell += "8"
                    turnEnds(bombedCell, theoreticalXBombed, theoreticalYBombed)
                    break;
                case "9":
                    theoreticalYBombed = 8 * gridStep + gridStep / 2 + opponentPositionsImgTop
                    bombedCell += "9"
                    turnEnds(bombedCell, theoreticalXBombed, theoreticalYBombed)
                    break;
                case "10":
                    theoreticalYBombed = 9 * gridStep + gridStep / 2 + opponentPositionsImgTop
                    bombedCell += "10"
                    turnEnds(bombedCell, theoreticalXBombed, theoreticalYBombed)
                    break;
                default:
                    Alert("Valore di yBombed non valido: " + yBombed);
            }





        }
    }




    let draggableElement;

    function makeMagazzinoDraggable() {
        console.log("klòccccccccccca")
        draggableElementArray = document.getElementsByClassName("draggableElement");
        for (let i = 0; i < draggableElementArray.length; i++) {
            //if(myArmyImgArray[i].style.position==""){
            let draggedYet = false
            draggableElementArray[i].addEventListener("mousedown", function (e) {
                console.log("klòzzzzzzzzza")

                if (!draggedYet) { dragFunction(i, e) }
                draggedYet = true

            });
            //  }
        }
    }



    function calculateShipsPositionsX(elementToDrag, elementToDragLeft, onMouseUptolerance, elementToDragRight, newShipTakenPositions) {
        console.log("klòaaaaa")
        let elementToDragWidth = elementToDrag.width
        let isElementTooFarRight
        elementToDragRight = elementToDragLeft + elementToDragWidth
        let myGridRight = myPositionsImgLeft + 300
        elementToDragRight > myGridRight ? isElementTooFarRight = true : isElementTooFarRight = false


        if (elementToDragLeft < (myPositionsImgLeft + 30)) {
            elementToDrag.style.left = myPositionsImgLeft + "px"
            elementToDrag.style.boxShadow = "none"
            newShipTakenPositions.x = "A"
        }
        else if (elementToDragLeft < (myPositionsImgLeft + 60)) {
            elementToDrag.style.left = (myPositionsImgLeft + 30) + "px"
            elementToDrag.style.boxShadow = "none"
            newShipTakenPositions.x = "B"

        }
        else if (elementToDragLeft < (myPositionsImgLeft + 90)) {
            elementToDrag.style.left = (myPositionsImgLeft + 60) + "px"
            elementToDrag.style.boxShadow = "none"
            newShipTakenPositions.x = "C"
        }
        else if (elementToDragLeft < (myPositionsImgLeft + 120)) {

            elementToDrag.style.left = (myPositionsImgLeft + 90) + "px"
            elementToDrag.style.boxShadow = "none"
            newShipTakenPositions.x = "D"
        }
        else if (elementToDragLeft < (myPositionsImgLeft + 150)) {
            elementToDrag.style.left = (myPositionsImgLeft + 120) + "px"
            elementToDrag.style.boxShadow = "none"
            newShipTakenPositions.x = "E"
        }
        else if ((isElementTooFarRight && elementToDragWidth == 150) || (elementToDragLeft < myPositionsImgLeft + 180)) {
            elementToDrag.style.left = (myPositionsImgLeft + 150) + "px"
            elementToDrag.style.boxShadow = "none"
            newShipTakenPositions.x = "F"
        }
        else if ((isElementTooFarRight && elementToDragWidth == 120) || (elementToDragLeft < myPositionsImgLeft + 210)) {
            elementToDrag.style.left = (myPositionsImgLeft + 180) + "px"
            elementToDrag.style.boxShadow = "none"
            newShipTakenPositions.x = "G"
        }
        else if ((isElementTooFarRight && elementToDragWidth == 90) || (elementToDragLeft < myPositionsImgLeft + 240)) {
            elementToDrag.style.left = (myPositionsImgLeft + 210) + "px"
            elementToDrag.style.boxShadow = "none"
            newShipTakenPositions.x = "H"
        }
        else if ((isElementTooFarRight && elementToDragWidth == 60) || (elementToDragLeft < myPositionsImgLeft + 270)) {
            elementToDrag.style.left = (myPositionsImgLeft + 240) + "px"
            elementToDrag.style.boxShadow = "none"
            newShipTakenPositions.x = "I"
        }
        else if ((isElementTooFarRight && elementToDragWidth == 30) || (elementToDragLeft < myPositionsImgLeft + 300)) {
            elementToDrag.style.left = (myPositionsImgLeft + 270) + "px"
            elementToDrag.style.boxShadow = "none"
            newShipTakenPositions.x = "J"
        }
    }


    function restartDrag(event) {
        console.log("klasdasdòa")

        if (freeCell == false) {
            console.log("restart " + freeCell)
            let lastAddedShipType = allArticlesPositions[allArticlesPositions.length - 1].type //user tried to put the last element inside a not free cell. Remove it from array (allArticlePositions)
            const indices = allArticlesPositions.map((ship, index) => ship.type === lastAddedShipType ? index : -1).filter(index => index !== -1);
            if (indices.length > 0) {
                const lastIndex = indices[indices.length - 1];
                allArticlesPositions.splice(lastIndex, 1);
            }
            dragFunction(lastDraggedElementIndex, event);
            freeCell = true
            document.removeEventListener("mousemove", restartDrag)
        }
    }



    function calculateOrizontalObjCells(newShipTakenPositions, newShipTakenPositionsXInAsii) {
        console.log("kssssssssssslòa")
        for (let i = 0; i < newShipTakenPositions.length; i++) {
            let nextX = String.fromCharCode(newShipTakenPositionsXInAsii + i)
            if (takenCellArray.includes(nextX + newShipTakenPositions.y)) {
                freeCell = false
            }
            else {
                freeCell = true
                newShipTakenPositions.positions.push(nextX + newShipTakenPositions.y)
            }
        }
    }


    function calculateVerticalObjCells(newShipTakenPositions, newShipTakenPositionsY) {
        console.log("ECCOLO      ", newShipTakenPositions, newShipTakenPositionsY)
        console.log(newShipTakenPositions.height, newShipTakenPositions)
        for (let i = 0; i < newShipTakenPositions.height; i++) {
            let nextY = parseInt(newShipTakenPositionsY) + i
            if (takenCellArray.includes(newShipTakenPositions.x + nextY)) {
                freeCell = false
            }
            else {
                freeCell = true
                newShipTakenPositions.positions.push(newShipTakenPositions.x + nextY)
                console.log(newShipTakenPositions.positions)
            }

        }
    }




    function calculateShipsPositionsY(elementToDrag, elementToDragTop, onMouseUptolerance, elementToDragBottom, newShipTakenPositions) {
        console.log("kl422òa")
        let elementToDragHeight = elementToDrag.height
        let isElementTooFarDown
        //let elementToDragBottom = elementToDragLeft + objWidth
        let myGridBottom = myPositionsImgTop + 300
        elementToDragBottom > myGridBottom ? isElementTooFarDown = true : isElementTooFarBottom = false
        if (elementToDragTop < (myPositionsImgTop + 30)) {
            elementToDrag.style.top = myPositionsImgTop + "px"
            elementToDrag.style.boxShadow = "none"
            if (newShipTakenPositions.direction == "horizontal") { // horizontal ship starting in 1
                newShipTakenPositions.y = "1"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []

                    let newShipTakenPositionsXInAsii = newShipTakenPositions.x.toUpperCase().charCodeAt(0)

                    calculateOrizontalObjCells(newShipTakenPositions, newShipTakenPositionsXInAsii)

                    if (newShipTakenPositions.positions.length == newShipTakenPositions.length) {//se l'array formato dalle celle posizionate con successo per questa nave ha la stessa lunghezza delle celle della nave (se tutte le nave è posizionata per intero)
                        takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                        shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                    }
                    else {
                        freeCell = false
                        restartDrag(event)
                    }
                }
            }

            else if (newShipTakenPositions.direction == "vertical") { // vertical ship starting in 1
                newShipTakenPositions.y = "1"
                console.log(newShipTakenPositions.x)
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    calculateVerticalObjCells(newShipTakenPositions, newShipTakenPositions.y)
                    if (newShipTakenPositions.positions.length == newShipTakenPositions.height) {//se l'array formato dalle celle libere per questa nave ha la stessa lunghezza delle celle della nave
                        takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                        shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                    } else {
                        freeCell = false
                        restartDrag(event)
                    }
                }
            }
        }

        else if (elementToDragTop < (myPositionsImgTop + 60)) {
            elementToDrag.style.top = myPositionsImgTop + 30 + "px"
            elementToDrag.style.boxShadow = "none"
            if (newShipTakenPositions.direction == "horizontal") { // horizontal ship starting in 2
                newShipTakenPositions.y = "2"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []

                    let newShipTakenPositionsXInAsii = newShipTakenPositions.x.toUpperCase().charCodeAt(0)
                    calculateOrizontalObjCells(newShipTakenPositions, newShipTakenPositionsXInAsii)

                    if (newShipTakenPositions.positions.length == newShipTakenPositions.length) {//se l'array formato dalle celle libere per questa nave ha la stessa lunghezza delle celle della nave
                        takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                        shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                    }
                    else {
                        freeCell = false
                        restartDrag(event)
                    }
                }
            }
            else if (newShipTakenPositions.direction == "vertical") { // vertical ship starting in 2
                newShipTakenPositions.y = "2"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    calculateVerticalObjCells(newShipTakenPositions, newShipTakenPositions.y)
                    if (newShipTakenPositions.positions.length == newShipTakenPositions.height) {//se l'array formato dalle celle libere per questa nave ha la stessa lunghezza delle celle della nave
                        takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                        shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                    } else {
                        freeCell = false
                        restartDrag(event)
                    }
                }
            }

        }

        else if (elementToDragTop < (myPositionsImgTop + 90)) {

            elementToDrag.style.top = myPositionsImgTop + 60 + "px"
            elementToDrag.style.boxShadow = "none"
            if (newShipTakenPositions.direction == "horizontal") { // horizontal ship starting in 3
                newShipTakenPositions.y = "3"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    let newShipTakenPositionsXInAsii = newShipTakenPositions.x.toUpperCase().charCodeAt(0)
                    calculateOrizontalObjCells(newShipTakenPositions, newShipTakenPositionsXInAsii)
                    if (newShipTakenPositions.positions.length == newShipTakenPositions.length) {//se l'array formato dalle celle libere per questa nave ha la stessa lunghezza delle celle della nave
                        takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                        shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                    }
                    else {
                        freeCell = false
                        restartDrag(event)
                    }

                }
            }
            else if (newShipTakenPositions.direction == "vertical") { // vertical ship starting in 3
                newShipTakenPositions.y = "3"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    calculateVerticalObjCells(newShipTakenPositions, newShipTakenPositions.y)
                    if (newShipTakenPositions.positions.length == newShipTakenPositions.height) {//se l'array formato dalle celle libere per questa nave ha la stessa lunghezza delle celle della nave
                        takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                        shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                    } else {
                        freeCell = false
                        restartDrag(event)
                    }
                }
            }
        }


        else if (elementToDragTop < (myPositionsImgTop + 120)) {
            elementToDrag.style.top = myPositionsImgTop + 90 + "px"
            elementToDrag.style.boxShadow = "none"
            if (newShipTakenPositions.direction == "horizontal") { // horizontal ship starting in 4
                newShipTakenPositions.y = "4"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    let newShipTakenPositionsXInAsii = newShipTakenPositions.x.toUpperCase().charCodeAt(0)
                    calculateOrizontalObjCells(newShipTakenPositions, newShipTakenPositionsXInAsii)

                    if (newShipTakenPositions.positions.length == newShipTakenPositions.length) {//se l'array formato dalle celle libere per questa nave ha la stessa lunghezza delle celle della nave
                        takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                        shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                    }
                    else {
                        freeCell = false
                        restartDrag(event)

                    }

                }
            }
            else if (newShipTakenPositions.direction == "vertical") { // vertical ship starting in 4
                newShipTakenPositions.y = "4"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    calculateVerticalObjCells(newShipTakenPositions, newShipTakenPositions.y)
                    if (newShipTakenPositions.positions.length == newShipTakenPositions.height) {//se l'array formato dalle celle libere per questa nave ha la stessa lunghezza delle celle della nave
                        takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                        shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                    } else {
                        freeCell = false
                        restartDrag(event)
                    }
                }
            }
        }

        else if (elementToDragTop < (myPositionsImgTop + 150)) {

            elementToDrag.style.top = myPositionsImgTop + 120 + "px"
            elementToDrag.style.boxShadow = "none"
            if (newShipTakenPositions.direction == "horizontal") { // horizontal ship starting in 5
                newShipTakenPositions.y = "5"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    let newShipTakenPositionsXInAsii = newShipTakenPositions.x.toUpperCase().charCodeAt(0)
                    calculateOrizontalObjCells(newShipTakenPositions, newShipTakenPositionsXInAsii)
                    if (newShipTakenPositions.positions.length == newShipTakenPositions.length) {//se l'array formato dalle celle libere per questa nave ha la stessa lunghezza delle celle della nave
                        takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                        shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                    }
                    else {
                        freeCell = false
                        restartDrag(event)

                    }
                }
            }
            else if (newShipTakenPositions.direction == "vertical") { // vertical ship starting in 5
                newShipTakenPositions.y = "5"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    calculateVerticalObjCells(newShipTakenPositions, newShipTakenPositions.y)
                    if (newShipTakenPositions.positions.length == newShipTakenPositions.height) {//se l'array formato dalle celle libere per questa nave ha la stessa lunghezza delle celle della nave
                        takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                        shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                    } else {
                        freeCell = false
                        restartDrag(event)
                    }
                }

            }
        }

        else if (elementToDragTop < (myPositionsImgTop + 180) || (isElementTooFarDown && elementToDragHeight == 150)) {
            elementToDrag.style.top = myPositionsImgTop + 150 + "px"
            elementToDrag.style.boxShadow = "none"
            if (newShipTakenPositions.direction == "horizontal") { // horizontal ship starting in 6
                newShipTakenPositions.y = "6"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    let newShipTakenPositionsXInAsii = newShipTakenPositions.x.toUpperCase().charCodeAt(0)
                    calculateOrizontalObjCells(newShipTakenPositions, newShipTakenPositionsXInAsii)

                    if (newShipTakenPositions.positions.length == newShipTakenPositions.length) {//se l'array formato dalle celle libere per questa nave ha la stessa lunghezza delle celle della nave
                        takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                        shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                    }
                    else {
                        freeCell = false
                        restartDrag(event)

                    }

                }
            }
            else if (newShipTakenPositions.direction == "vertical") { // vertical ship starting in 6
                newShipTakenPositions.y = "6"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    calculateVerticalObjCells(newShipTakenPositions, newShipTakenPositions.y)
                }
                if (newShipTakenPositions.positions.length == newShipTakenPositions.height) { //if array of accepted position (freeCells)== ship's height 
                    takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                    shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                } else {
                    freeCell = false
                    restartDrag(event)
                }
            }
        }


        else if (elementToDragTop < (myPositionsImgTop + 210) || (isElementTooFarDown && elementToDragHeight == 120)) {

            elementToDrag.style.top = myPositionsImgTop + 180 + "px"
            elementToDrag.style.boxShadow = "none"
            if (newShipTakenPositions.direction == "horizontal") { // horizontal ship starting in 7
                newShipTakenPositions.y = "7"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    let newShipTakenPositionsXInAsii = newShipTakenPositions.x.toUpperCase().charCodeAt(0)
                    calculateOrizontalObjCells(newShipTakenPositions, newShipTakenPositionsXInAsii)

                    if (newShipTakenPositions.positions.length == newShipTakenPositions.length) {//se l'array formato dalle celle libere per questa nave ha la stessa lunghezza delle celle della nave
                        takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                        shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                    }
                    else {
                        freeCell = false
                        restartDrag(event)

                    }
                }
            }
            else if (newShipTakenPositions.direction == "vertical") { // vertical ship starting in 7
                newShipTakenPositions.y = "7"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    calculateVerticalObjCells(newShipTakenPositions, newShipTakenPositions.y)
                }
                if (newShipTakenPositions.positions.length == newShipTakenPositions.height) { //if array of accepted position (freeCells)== ship's height 
                    takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                    shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                } else {
                    freeCell = false
                    restartDrag(event)
                }
            }

        }


        else if (elementToDragTop < (myPositionsImgTop + 240) || (isElementTooFarDown && elementToDragHeight == 90)) {

            elementToDrag.style.top = myPositionsImgTop + 210 + "px"
            elementToDrag.style.boxShadow = "none"
            if (newShipTakenPositions.direction == "horizontal") { // horizontal ship starting in 8
                newShipTakenPositions.y = "8"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    let newShipTakenPositionsXInAsii = newShipTakenPositions.x.toUpperCase().charCodeAt(0)
                    calculateOrizontalObjCells(newShipTakenPositions, newShipTakenPositionsXInAsii)


                    if (newShipTakenPositions.positions.length == newShipTakenPositions.length) {//se l'array formato dalle celle libere per questa nave ha la stessa lunghezza delle celle della nave
                        takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                        shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                    }
                    else {
                        freeCell = false
                        restartDrag(event)

                    }

                }
            }
            else if (newShipTakenPositions.direction == "vertical") { // vertical ship starting in 8
                newShipTakenPositions.y = "8"
                console.log(newShipTakenPositions.x)

                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    calculateVerticalObjCells(newShipTakenPositions, newShipTakenPositions.y)
                }
                if (newShipTakenPositions.positions.length == newShipTakenPositions.height) { //if array of accepted position (freeCells)== ship's height 
                    takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                    shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                } else {
                    freeCell = false
                    restartDrag(event)
                }
            }

        }

        else if (elementToDragTop < (myPositionsImgTop + 270) || (isElementTooFarDown && elementToDragHeight == 60)) {
            elementToDrag.style.top = myPositionsImgTop + 240 + "px"
            elementToDrag.style.boxShadow = "none"
            if (newShipTakenPositions.direction == "horizontal") { // horizontal ship starting in 9
                newShipTakenPositions.y = "9"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    let newShipTakenPositionsXInAsii = newShipTakenPositions.x.toUpperCase().charCodeAt(0)
                    calculateOrizontalObjCells(newShipTakenPositions, newShipTakenPositionsXInAsii)


                    if (newShipTakenPositions.positions.length == newShipTakenPositions.length) {//se l'array formato dalle celle libere per questa nave ha la stessa lunghezza delle celle della nave
                        takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                        shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                    }
                    else {
                        freeCell = false
                        restartDrag(event)

                    }

                }
            }
            else if (newShipTakenPositions.direction == "vertical") { // vertical ship starting in 9
                newShipTakenPositions.y = "9"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    calculateVerticalObjCells(newShipTakenPositions, newShipTakenPositions.y)
                }
                if (newShipTakenPositions.positions.length == newShipTakenPositions.height) { //if array of accepted position (freeCells)== ship's height 
                    takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                    shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                } else {

                    freeCell = false
                    restartDrag(event)
                }

            }
        }


        else if (elementToDragTop < (myPositionsImgTop + 300 + onMouseUptolerance) || (isElementTooFarDown && elementToDragHeight == 30)) {

            elementToDrag.style.top = myPositionsImgTop + 270 + "px"
            elementToDrag.style.boxShadow = "none"
            if (newShipTakenPositions.direction == "horizontal") { // horizontal ship starting in 10
                newShipTakenPositions.y = "10"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    let newShipTakenPositionsXInAsii = newShipTakenPositions.x.toUpperCase().charCodeAt(0)
                    calculateOrizontalObjCells(newShipTakenPositions, newShipTakenPositionsXInAsii)


                    if (newShipTakenPositions.positions.length == newShipTakenPositions.length) {//se l'array formato dalle celle libere per questa nave ha la stessa lunghezza delle celle della nave
                        takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                        shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                    }
                    else {
                        freeCell = false
                        restartDrag(event)

                    }
                }
            }
            else if (newShipTakenPositions.direction == "vertical") { // vertical ship starting in 10
                newShipTakenPositions.y = "10"
                if (newShipTakenPositions.x !== undefined) {
                    newShipTakenPositions.positions = []
                    calculateVerticalObjCells(newShipTakenPositions, newShipTakenPositions.y)
                }
                if (newShipTakenPositions.positions.length == newShipTakenPositions.height) { //if array of accepted position (freeCells)== ship's height 
                    takenCellArray = takenCellArray.concat(newShipTakenPositions.positions)
                    shipsPositionsCells = shipsPositionsCells.concat(newShipTakenPositions.positions)
                } else {
                    freeCell = false
                    restartDrag(event)
                }
            }

        }
    }

    let allArticlesPositions = []

    function calculateShipsPositions(elementToDrag, elementToDragLeft, elementToDragTop, onMouseUptolerance, elementToDragRight, elementToDragBottom) {
        console.log("k123213lòa")
        let objHorizontalCells = elementToDrag.width / 30
        let objVerticalCells = elementToDrag.height / 30
        let type
        let newShipTakenPositions


        if (objHorizontalCells == 1 && objVerticalCells == 1) { //not a ship
            type = elementToDrag.src.split("assets/")[1].split(".png")[0]
            newShipTakenPositions = {
                type: type,
                direction: "horizontal",
                length: objHorizontalCells,
                height: objVerticalCells,
                positions: []
            }
        }
        else if (objHorizontalCells > objVerticalCells) { //Horizontal ship
            type = objHorizontalCells + " cells ship"
            newShipTakenPositions = {
                type: type,
                direction: "horizontal",
                length: objHorizontalCells,
                height: objVerticalCells,
                positions: []
            }


        }
        else if (objHorizontalCells < objVerticalCells) { //Vertical ship
            type = objVerticalCells + " cells ship"
            newShipTakenPositions = {
                type: type,
                direction: "vertical",
                length: objHorizontalCells,
                height: objVerticalCells,
                positions: []
            }
        }
        allArticlesPositions.push(newShipTakenPositions)

        calculateShipsPositionsX(elementToDrag, elementToDragLeft, onMouseUptolerance, elementToDragRight, newShipTakenPositions)
        calculateShipsPositionsY(elementToDrag, elementToDragTop, onMouseUptolerance, elementToDragBottom, newShipTakenPositions)
    }
    let turnObjImgArray = "notDoneYet"
    let lastDraggedElementIndex

    function dragFunction(elementIndex, event) {
        console.log("klff333òa")

        const elementToDrag = draggableElementArray[elementIndex];
        elementToDrag.style.position = "absolute";


        if (turnObjImgArray == "notDoneYet") {
            turnObjImgArray = document.getElementsByClassName("turnObjImg")
            for (let i = 0; i < turnObjImgArray.length; i++) {
                turnObjImgArray[i].style.display = 'none';
            }
        }
        //let offsetX = event.clientX - elementToDrag.getBoundingClientRect().left;
        // let offsetY = event.clientY - elementToDrag.getBoundingClientRect().top - window.scrollY;
        let isDragging = true;
        lastDraggedElementIndex = elementIndex
        function onMouseMove(event) {
            if (isDragging) {
                console.log("ksdflòa")
                elementToDrag.style.left = event.clientX + 'px';
                elementToDrag.style.top = event.clientY + 'px';
            }
        }
        function onMouseUp() {
            console.log("ksdfsdsslòa")
            let elementToDragLeft = parseFloat(elementToDrag.style.left)
            let elementToDragTop = parseFloat(elementToDrag.style.top)
            let elementToDragWidth = elementToDrag.offsetWidth
            let elementToDragHeight = elementToDrag.offsetHeight
            let elementToDragRight = elementToDragLeft + elementToDragWidth
            let elementToDragBottom = elementToDragTop + elementToDragHeight
            let onMouseUptolerance = 10
            if (elementToDragLeft > (myPositionsImgLeft - onMouseUptolerance) && elementToDragRight < (myPositionsImgLeft + 300 + onMouseUptolerance) && elementToDragTop > myPositionsImgTop - onMouseUptolerance && elementToDragBottom < (myPositionsImgTop + 300 + onMouseUptolerance)) {
                isDragging = false; //aggiungere la consizione "se la cella è libera"
                console.log("è dentro")
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
                calculateShipsPositions(elementToDrag, elementToDragLeft, elementToDragTop, elementToDragWidth, onMouseUptolerance, elementToDragRight, elementToDragBottom)
            }
            console.log("è fuori")

        }
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
        document.addEventListener('mousemove', restartDrag);

        event.preventDefault();
    }

    /* function hideOrShowMercato() {
         if (mercatoSect.style.display == "" || mercatoSect.style.display == "block") {
             mercatoSect.style.display = "none"
         }
         else if (mercatoSect.style.display == "none") {
             mercatoSect.style.display = "block"
             if (stopMarket) {
                 document.getElementsByClassName("marketSubSects")[0].style.backgroundColor = "#ff00008f"
                 document.getElementsByClassName("marketSubSects")[1].style.backgroundColor = "#ff00008f"
                 document.getElementsByClassName("marketSubSects")[2].style.backgroundColor = "#ff00008f"
                 document.getElementsByClassName("marketSubSects")[3].style.backgroundColor = "#ff00008f"
             }
         }
     }
 
     hideMercato.addEventListener("click", hideOrShowMercato)*/


    let stopMarket = false

    endMarketBtn.addEventListener("click", () => {
        makeMagazzinoDraggable();
        endMarketBtn.style.display = "none";
        stopMarket = true;
        document.getElementById("marketDiv").style.display = "none"
        //hideOrShowMercato();
        removeListenerMsgOpenMarket()
        printScreenAssistantMessage("Ricorda che, dopo il trascinamento, la nave ricadrà nella cella ricoperta dalla sua estremità superiore sinistra. ")
    })

    opponentPositionsImg.addEventListener('click', (event) => logCoordinates(event, "opponentGrid"))
    myPositionsImg.addEventListener('click', (event) => logCoordinates(event, "myGrid"))

    function turnStarts() {
        console.log("ksdflaaaaaaaaaaòa")
        const data = {
            IDMatch: effectiveIDMatch,
            myName: myName.value
        };
        if (!localStorage.getItem("tokenGND")) { alert("Problema di autentificazione: purtroppo la partita è da rifare"); return }
        const token = localStorage.getItem('tokenGND')
        fetch('http://localhost:3001/api/turnStarts', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
            .then(response => {
                return response.json().then(responseBody => {
                    if (response.ok) {

                        if (responseBody.message == ("Not your turn.")) {
                            printScreenAssistantMessage("Non è ancora il tuo turno.");

                        }
                        if (responseBody.message != "Not your turn.") {
                            isMyTurn = true
                            printScreenAssistantMessage(responseBody.message);
                            clearInterval(interval)
                        }

                    }
                    else {
                        console.log(responseBody.message)

                    }
                })
            })
    }

    function turnEnds(bombedCell, theoreticalXBombed, theoreticalYBombed) {
        console.log("ks424dflòa")
        if (!localStorage.getItem("tokenGND")) {
            alert("Problema di autentificazione: purtroppo la partita è da rifare");
            return
        }
        const token = localStorage.getItem('tokenGND')

        const myName = document.getElementById('myName').value;
        const IDMatch = document.getElementById('IDMatch').value;

        console.log(myName, IDMatch);

        if (myName != "" && myName.length < 16) {
            const data = {
                myName: myName,
                IDMatch: IDMatch,
                bombedCell: bombedCell
            };
            console.log(bombedCell)
            fetch('http://localhost:3001/api/turnEnds', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then(response => {
                    return response.json().then(responseBody => {
                        if (response.ok) {


                            isMyTurn = false
                            console.log(response)

                            let responseToPrint = responseBody.message
                            printScreenAssistantMessage(responseToPrint)
                            interval = setInterval(turnStarts, 1500);
                            if (responseToPrint.includes("Complimenti")) {
                                console.log("aa", theoreticalXBombed, theoreticalYBombed)
                                const circleBomb = document.createElement('div');
                                circleBomb.style.width = '30px';
                                circleBomb.style.height = '30px';
                                circleBomb.style.backgroundColor = 'black';
                                circleBomb.style.borderRadius = '50%';
                                circleBomb.style.position = 'absolute';
                                circleBomb.style.top = (theoreticalYBombed - 15) + "px"
                                circleBomb.style.left = (theoreticalXBombed - 15) + "px"
                                document.body.appendChild(circleBomb);
                                circleBomb.className = "imBombingAnimation"
                            }



                            else if (responseBody.divertedShotCell) {
                                console.log(" il jammer ha deviato in " + divertedShotCell)
                                const circleBomb = document.createElement('div');
                                circleBomb.style.width = '30px';
                                circleBomb.style.height = '30px';
                                circleBomb.style.backgroundColor = 'black';
                                circleBomb.style.borderRadius = '50%';
                                circleBomb.style.position = 'absolute';
                                circleBomb.style.top = (theoreticalYBombed - 15) + "px"
                                circleBomb.style.left = (theoreticalXBombed - 15) + "px"
                                document.body.appendChild(circleBomb);
                                circleBomb.className = "imBombingAnimationJammer"
                            }

                            else if (responseToPrint == "Un jammer nemico è riuscito a deviare con successo il tuo colpo.") {
                                console.log(" il jammer ha deviato in ")
                                const circleBomb = document.createElement('div');
                                circleBomb.style.width = '30px';
                                circleBomb.style.height = '30px';
                                circleBomb.style.backgroundColor = 'black';
                                circleBomb.style.borderRadius = '50%';
                                circleBomb.style.position = 'absolute';
                                circleBomb.style.top = (theoreticalYBombed - 15) + "px"
                                circleBomb.style.left = (theoreticalXBombed - 15) + "px"
                                document.body.appendChild(circleBomb);
                                circleBomb.className = "imBombingAnimationJammerFail"
                            }


                        } else {
                            printScreenAssistantMessage(responseBody.message);
                            throw new Error('Network response was not ok: ' + responseBody.error);
                        }
                    });
                });
        } else {
            console.log("Qualcosa è andato storto R")

        }
    }

</script>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Knewave&display=swap');

    * {
        font-family: "Atma", system-ui;
    }

    @keyframes imBombingAnimationKeyframes {
        0% {
            background-color: black;


        }

        20% {
            background-color: rgb(66, 45, 46);
            box-shadow: 0px 0px 10px 6px rgb(255, 170, 0)
        }

        50% {
            background-color: red;
            box-shadow: 0px 0px 20px 26px rgb(255, 170, 0)
        }

        100% {
            background-color: rgb(89, 89, 89);
        }
    }

    .imBombingAnimation {
        animation: imBombingAnimationKeyframes 1.6s forwards;
    }

    @keyframes imBombingAnimationFailsKeyframes {
        0% {
            background-color: rgb(255, 255, 255);


        }

        20% {
            background-color: rgb(85, 142, 255);
            box-shadow: 0px 0px 10px 6px rgb(255, 170, 0)
        }

        50% {
            background-color: rgb(13, 0, 255);
            box-shadow: 0px 0px 20px 26px rgb(255, 170, 0)
        }

        100% {
            background-color: rgb(0, 0, 0);
        }
    }

    @keyframes imBombingAnimationAirDefenceKeyframes {
        0% {
            background-color: rgb(255, 255, 255);


        }

        20% {
            background-color: rgb(255, 0, 0);
            box-shadow: 0px 0px 10px 6px rgb(255, 170, 0)
        }

        50% {
            background-color: rgb(84, 0, 17);
            box-shadow: 0px 0px 20px 26px rgb(255, 170, 0)
        }

        100% {
            background-color: rgb(106, 0, 0);
        }
    }

    @keyframes imBombingAnimationJammersKeyframes {
        0% {
            background-color: rgb(255, 255, 255);


        }

        20% {
            background-color: rgb(30, 182, 0);
            box-shadow: 0px 0px 10px 6px rgb(255, 170, 0)
        }

        50% {
            background-color: rgb(33, 134, 0);
            box-shadow: 0px 0px 20px 26px rgb(255, 170, 0)
        }

        100% {
            background-color: rgb(0, 245, 53);
        }
    }

    .imBombingAnimationFail {
        animation: imBombingAnimationFailKeyframes 1.6s forwards;
    }

    .imBombingAnimationJammer {
        animation: imBombingAnimationJammerKeyframes 1.6s forwards;
    }

    .imBombingAnimationAirDefense {
        animation: imBombingAnimationAirDefenseKeyframes 1.6s forwards;
    }




    .coin {
        width: 30px;
    }


    #myArmyList {
        display: flex;
        flex-wrap: wrap;
        width: 100%;
        justify-content: flex-start;
        height: 160px;
    }

    #myArmyList>li {
        width: auto;
        margin: 0 5px
    }

    #goldSect {
        display: flex;
        align-items: center;
        justify-content: space-around;
    }

    button {
        background-color: grey;
    }

    #gridsSect {
        display: flex;
        justify-content: space-around;
    }

    .positionsImg {
        height: 300px;
    }

    #myPositionsImg,
    #myScreenAssistant {
        box-shadow: 1px -1px 20px 8px green
    }

    #myScreenAssistant {
        height: 20vh;
        width: 300px;
        background-color: rgba(0, 0, 0, 0.521);
        font-size: larger;
        color: rgb(0, 255, 0);
        padding: 10px;
        box-sizing: border-box;
    }

    #newMatchConsole {
        height: 20vh;
        width: 300px;
        background-color: rgba(0, 0, 0, 0.521);
        font-size: larger;
        color: #ff0000ad;
        padding: 3px 10px;
        box-sizing: border-box;
        box-shadow: 1px -1px 20px 8px #ff0000ad;
        margin-block-start: 1em;
        margin-block-end: 1em;
    }

    #newMatchConsole label {
        font-size: medium;

    }

    form {
        display: flex;
        flex-direction: column;
    }

    .turnObjImg {
        width: 30px;
        height: 30px;
    }

    .coinSpan {
        display: flex;
    }

    #opponentPositionsImg {
        box-shadow: 1px -1px 20px 8px #ff0000ad
    }

    #myGridSpan {
        display: flex;
        justify-content: space-between;
    }

    .gridTitle {
        margin-bottom: 30px
    }

    .gridSpan {
        display: flex;
        flex-direction: column;
    }

    .activeTurn {
        width: 300px;
        border-radius: 20px;
        box-shadow: 0px 0px 30px 30px blue;
    }

    .armyObj {
        width: 30px;
        height: 30px;
    }

    .horizontal2Ship {
        width: 60px;
        height: 30px;

    }

    button {
        background-color: #00d0ff
    }

    .horizontal3Ship {
        width: 90px;
        height: 30px;
    }

    .horizontal4Ship {
        width: 120px;
        height: 30px;
    }

    .infoIconMarket {
        width: 20px;
        height: 20px;
        align-self: center
    }

    .articleNameSpan {
        width: 50%;
        display: flex;
    }

    #magazzinoSect {
        height: 25vh;
        display: flex;
        height: 100px;
        margin: 10px 0;
        background-color: rgba(255, 255, 255, 0.1);


    }

    .horizontal5Ship {
        width: 150px;
        height: 30px;
    }

    .vertical4Ship {
        width: 30px;
        height: 120px;
    }

    .vertical3Ship {
        width: 30px;
        height: 90px;
    }

    #readyBtn {
        height: 52px;
    }

    .vertical2Ship {
        width: 30px;
        height: 60px;
    }

    .vertical5Ship {
        width: 30px;
        height: 150px;
    }

    .not_visible {
        display: none;
    }



    body {
        user-select: none;

        margin: 0;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url(./assets/ship-158847_1280.png);
        background-color: rgb(46, 40, 68);
        /* background: linear-gradient(33deg, #496e6c, #0058b0, #000204, #0058b0, #00264d);
        background-size: 400% 400%;
        animation: gradientAnimation 15s ease infinite;*/
    }

    @keyframes gradientAnimation {
        0% {
            background-position: 0% 50%;
        }

        50% {
            background-position: 100% 50%;
        }

        100% {
            background-position: 0% 50%;
        }
    }



    .myArmyImg {
        box-shadow: 3px -3px 1px 2px #00000061;
    }

    h1 {
        height: 5vh;
    }

    h1,
    h2,
    h3 {
        text-align: center;
        text-shadow: 1px -1px 2px #00a8ff;
        margin: 0
    }

    .spanLetterAxis {
        width: 30px;
        height: 30px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #mercatoSpan {
        position: absolute;
        top: 25vh;
        width: 12%;
        left: 44%;
    }


    #mercatoSect {
        position: absolute;
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 20%;
        top: 32vh;
        height: 60vh;
        justify-content: space-evenly;
        left: 40%
    }



    #mercatoSect>section {
        width: 100%;
        padding: 010px;
        border-radius: 20px;
        box-shadow: inset -1px -1px 20px 6px rgba(0, 0, 0, 0.5);
        background-color: grey;
    }

    li {
        width: 100%;
        display: flex;
        justify-content: space-between;
        text-align: center;
    }

    ul {
        list-style-type: none;
        padding: 0;
        margin: 0;
    }

    .grid {
        height: 300px;
        height: 300px;
        border: solid grey;
    }

    #mercatoSect section {
        margin: 2px 0
    }

    #mercatoSect button {
        width: 25px;
        height: 25px;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 0;
        border-radius: 5px
    }

    .minusBtn {
        background-color: grey;
    }

    .plusBtn {
        background-color: rgb(86, 86, 255);
    }

    #tab {
        height: 100px;
    }



    #matchDiv {
        display: flex;
        flex-direction: column;
    }

    h2 {
        padding: 10px 0;
        box-sizing: border-box;
    }

    #marketDiv {
        width: 80px;
        background-color: #0058b0;
        opacity: 0;
    }

    #myXAxisSpan,
    #XAxisSpanAdv {
        width: 300px;
        height: 30px;
        position: absolute;
        display: flex;
        background-color: rgba(128, 128, 128, 0.419);
        color: greenyellow;
        font-weight: 400;
    }

    #myYAxisSpan,
    #YAxisSpanAdv {
        background-color: rgba(128, 128, 128, 0.419);

        width: 30px;
        height: 300px;
        font-weight: 400;
        position: absolute;
        display: flex;
        flex-direction: column;
    }

    #myXaxisSpan,
    #myYAxisSpan {
        color: greenyellow;
    }

    #YAxisSpanAdv,
    #XAxisSpanAdv {
        color: #ff4e2f
    }

    @media screen and (min-width: 3000px) and (max-width: 12800px) {
        #gridsSect {
            flex-direction: column;
            align-items: center;

        }

        #myPositionImg {
            width: 300px;
        }

        .gridSpan {
            width: 300px;
        }

        .gridSpan span {
            width: 300px;
        }

        #mercatoSect {
            position: relative;
            display: flex;
            flex-direction: column;
            width: 100%;
            top: auto;
            height: auto;
            left: auto
        }

        #marketDiv {
            width: auto;
        }

        #magazzinoSect {
            height: auto;
            flex-direction: column;
            background-color: rgba(255, 255, 255, 0.368);

        }

        #myArmyList {
            flex-direction: column;
            height: auto;
        }

        #myArmyList li {
            height: 40px;
        }


    }
</style>
